#################################################################
## MATRIX JOB TO BUILD FROM SOURCE FOR FUTURE CANDIDATE BUILDS ##
#################################################################

#    parameters:
#      - label:
#          name: node
#          default: aos-ci-cd-slave in the openshift-enterprise tenant
#          description: "The node on which to run the job"

- job-template:
    name: '{paas-bfs-master-name}-0-test-matrix'
    defaults: openshift-defaults
    concurrent: false
    node: '{jslave_name}'
    project-type: matrix
    axes:
      - axis:
          type: user-defined
          name: TOPOLOGY
          values:
            - os_origin-3node-cluster
      - axis:
         type: slave
         name: nodes
         values:
          - '{jslave_name}'
    scm:
      - paas-sig-ci-scm
    wrappers:
      - openshift-cred-wrappers
    builders:
      - shell: |
          {provision-cluster}
      - shell: |
          {prep-cluster}
      - shell: |
          {bfs-origin}
      - shell: |
          {bfs-openshift-ansible}
      - shell: |
          {deploy-aosi}
      - shell: |
          {run-e2e-tests}
    publishers:
      - archive:
          artifacts: "**/*.output, **/${{TOPOLOGY}}.inventory"
          allow-empty: 'false'
      - openshift-email
      - postbuildscript:
          builders:
            - shell: |
                {teardown-cluster}
          script-only-if-succeeded: false
          execute-on: axes

- job-group:
    name: paas-bfs-master-provision-prep-test-teardown
    jobs:
        - '{paas-bfs-master-name}-0-test-matrix'

